{{!-- Party Statistics Window Template --}}
<div class="stats-window foundry-style-window">
  <div class="stats-header-sticky">
    <div class="stats-header">
      <div class="stats-header-content">
        <div class="stats-header-icon"><i class="fas fa-chart-line"></i></div>
        <div class="stats-header-title">
          <div class="stats-header-maintitle">Party Statistics</div>
          <div class="stats-header-subtitle">Review recent combats and lifetime performance</div>
        </div>
        <div class="stats-header-controls">
          <div class="stats-toggle-container">
            <span class="stats-toggle-label">Combat History</span>
            <div class="stats-toggle">
              <input type="checkbox" id="toggleCombats" {{#if filters.showCombats}}checked{{/if}}>
              <label for="toggleCombats" class="stats-toggle-slider"></label>
            </div>
          </div>
          <div class="stats-toggle-container">
            <span class="stats-toggle-label">Lifetime Leaderboard</span>
            <div class="stats-toggle">
              <input type="checkbox" id="toggleLifetime" {{#if filters.showLifetime}}checked{{/if}}>
              <label for="toggleLifetime" class="stats-toggle-slider"></label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="stats-summary-row">
      <div class="stats-summary-item">
        <i class="fa-solid fa-trophy"></i>
        <div class="stats-summary-content">
          <span class="label">Top MVP</span>
          <span>{{summary.topMvp}}</span>
        </div>
      </div>
      <div class="stats-summary-item">
        <i class="fa-solid fa-crosshairs"></i>
        <div class="stats-summary-content">
          <span class="label">Encounters</span>
          <span>{{summary.totalCombats}}</span>
        </div>
      </div>
      <div class="stats-summary-item stats-summary-item-progress">
        <i class="fa-solid fa-bullseye"></i>
        <div class="stats-summary-content">
          <span class="label">Average Hit Rate</span>
          <div class="stats-progress-bar">
            <div class="stats-progress-fill" style="width: {{summary.averageHitRateValue}}%"></div>
            <span class="stats-progress-text">{{summary.averageHitRate}}%</span>
          </div>
        </div>
      </div>
      <div class="stats-summary-item">
        <i class="fa-solid fa-star"></i>
        <div class="stats-summary-content">
          <span class="label">Best Score</span>
          <span>{{summary.bestScore}}</span>
        </div>
      </div>
      <div class="stats-summary-item">
        <i class="fa-solid fa-fire-flame"></i>
        <div class="stats-summary-content">
          <span class="label">Crits | Fumbles</span>
          <span>{{summary.totalCriticals}} | {{summary.totalFumbles}}</span>
        </div>
      </div>
      <div class="stats-summary-item">
        <i class="fa-solid fa-swords"></i>
        <div class="stats-summary-content">
          <span class="label">Damage Dealt</span>
          <span>{{summary.totalDamageGiven}}</span>
        </div>
      </div>
      <div class="stats-summary-item">
        <i class="fa-solid fa-shield"></i>
        <div class="stats-summary-content">
          <span class="label">Damage Taken</span>
          <span>{{summary.totalDamageTaken}}</span>
        </div>
      </div>
      <div class="stats-summary-item">
        <i class="fa-solid fa-heart"></i>
        <div class="stats-summary-content">
          <span class="label">Heals Given</span>
          <span>{{summary.totalHealsGiven}}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="stats-body-scroll">
    <div class="stats-section {{#unless filters.showCombats}}hidden{{/unless}}" data-section="combat-history">
      <div class="stats-section-header">
        <i class="fas fa-crosshairs"></i> Recent Encounter History
        <div class="stats-section-header-actions">
          {{#if combats.length}}
          <button type="button" class="stats-action-btn delete-history-btn" title="Delete all combat history"><i class="fas fa-trash"></i> Delete Stats</button>
          <span class="button-divider">|</span>
          <button type="button" class="stats-action-btn export-history"><i class="fas fa-file-download"></i> Export Stats</button>
          <span class="button-divider">|</span>
          {{/if}}
          <button type="button" class="stats-action-btn import-history"><i class="fas fa-file-upload"></i> Import Stats</button>
        </div>
      </div>
      <div class="stats-table-wrapper" data-table-type="combats">
        <div class="stats-table-header">
          <span class="stats-table-col stats-col-flex stats-col-left stats-table-col-header">Encounter</span>
          <span class="stats-table-col stats-col-size-20 stats-col-left stats-table-col-header">Date</span>
          <span class="stats-table-col stats-col-size-10 stats-col-center stats-table-col-header">Rounds</span>
          <span class="stats-table-col stats-col-size-10 stats-col-center stats-table-col-header">Hit Rate</span>
          <span class="stats-table-col stats-col-size-20 stats-col-left stats-table-col-header">MVP</span>
          <span class="stats-table-col stats-col-size-10 stats-col-left stats-table-col-header">Duration</span>
          <span class="stats-table-col stats-col-size-05 stats-col-right stats-table-col-header"> </span>
        </div>
        <div class="stats-table-body">
          {{#if combats.length}}
            {{#each combats}}
              <div class="stats-table-row" data-row-type="combat" data-combat-id="{{combatId}}">
                <span class="stats-table-col stats-col-flex stats-col-left">{{label}}</span>
                <span class="stats-table-col stats-col-size-20 stats-col-left">{{dateFormatted}}</span>
                <span class="stats-table-col stats-col-size-10 stats-col-center">{{rounds}}</span>
                <span class="stats-table-col stats-col-size-10 stats-col-center">{{hitRate}}</span>
                <span class="stats-table-col stats-col-size-20 stats-col-left">{{mvpName}} ({{mvpScore}})</span>
                <span class="stats-table-col stats-col-size-10 stats-col-left">{{duration}}</span>
                <span class="stats-table-col stats-col-size-05 stats-col-right">
                  <button type="button" class="delete-combat-btn" title="Delete this Encounter" data-combat-id="{{combatId}}">
                    <i class="fas fa-times"></i>
                  </button>
                </span>
              </div>
            {{/each}}
          {{else}}
            <div class="stats-empty-state">No combat history recorded yet.</div>
          {{/if}}
        </div>
      </div>
      <div class="stats-section-footer">Showing {{#if combats.length}}{{combats.length}}{{else}}0{{/if}} combat sessions.</div>
    </div>

    <div class="stats-section {{#unless filters.showLifetime}}hidden{{/unless}}" data-section="lifetime-leaderboard">
      <div class="stats-section-header"><i class="fas fa-trophy"></i> Lifetime Player Leaderboard</div>
      <div class="stats-table-wrapper" data-table-type="leaderboard">
        <div class="stats-table-header">
          <span class="stats-table-col stats-col-size-05 stats-col-center stats-table-col-header">Rank</span>
          <span class="stats-table-col stats-col-flex stats-col-left gap-wide stats-table-col-header">Player</span>
          <span class="stats-table-col stats-col-size-10 stats-col-center stats-table-col-header">Combats</span>
          <span class="stats-table-col stats-col-size-10 stats-col-right stats-table-col-header">Total MVP</span>
          <span class="stats-table-col stats-col-size-10 stats-col-right stats-table-col-header">Avg MVP</span>
          <span class="stats-table-col stats-col-size-10 stats-col-right stats-table-col-header">Best MVP</span>
          <span class="stats-table-col stats-col-size-05 stats-col-center stats-table-col-header">Crits</span>
          <span class="stats-table-col stats-col-size-05 stats-col-center stats-table-col-header">Fumbles</span>
          <span class="stats-table-col stats-col-size-10 stats-col-right stats-table-col-header">Biggest Hit</span>
        </div>
        <div class="stats-table-body">
          {{#if leaderboard.length}}
            {{#each leaderboard}}
              <div class="stats-table-row" data-row-type="leaderboard" data-actor-id="{{actorId}}">
                <span class="stats-table-col stats-col-size-05 stats-col-center">{{rank}}</span>
                <span class="stats-table-col stats-col-flex stats-col-left gap-wide">
                  <img class="player-portrait" src="{{img}}" alt="{{name}}">
                  <span class="player-name">{{name}}</span>
                </span>
                <span class="stats-table-col stats-col-size-10 stats-col-center">{{mvp.combats}}</span>
                <span class="stats-table-col stats-col-size-10 stats-col-right">{{mvp.totalScore}}</span>
                <span class="stats-table-col stats-col-size-10 stats-col-right">{{mvp.averageScore}}</span>
                <span class="stats-table-col stats-col-size-10 stats-col-right">{{mvp.highScore}}</span>
                <span class="stats-table-col stats-col-size-05 stats-col-center">{{crits}}</span>
                <span class="stats-table-col stats-col-size-05 stats-col-center">{{fumbles}}</span>
                <span class="stats-table-col stats-col-size-10 stats-col-right">{{biggestHit}}</span>
              </div>
            {{/each}}
          {{else}}
            <div class="stats-empty-state">No lifetime MVP data yet.</div>
          {{/if}}
        </div>
      </div>
      <div class="stats-section-footer">Rank is based on overall MVP score.</div>
    </div>

    <div class="stats-section" data-section="mvp-history">
      <div class="stats-section-header"><i class="fas fa-medal"></i> Party Highlights</div>
      <div class="stats-highlight-grid">
        {{#if highlights.length}}
          {{#each highlights}}
            <div class="stats-highlight-card">
              <div class="highlight-header">
                <img class="player-portrait" src="{{img}}" alt="{{player}}">
                <div class="highlight-title">
                  <div class="highlight-player">{{player}}</div>
                  <div class="highlight-score">Score: {{score}}</div>
                </div>
              </div>
              <div class="highlight-body">
                <div><span class="label">Combat:</span> {{combat}}</div>
                <div><span class="label">Damage:</span> {{damage}}</div>
                <div><span class="label">Healing:</span> {{healing}}</div>
                <div><span class="label">Notes:</span> {{notes}}</div>
              </div>
            </div>
          {{/each}}
        {{else}}
          <div class="stats-empty-state">Complete a combat to see MVP highlights.</div>
        {{/if}}
      </div>
      <div class="stats-section-footer">Showing {{#if highlights.length}}{{highlights.length}}{{else}}0{{/if}} MVP highlights.</div>
    </div>
  </div>

  <div class="stats-footer">
    <div class="stats-footer-actions">
      <button type="button" class="stats-btn close-stats"><i class="fas fa-times"></i> Close</button>
    </div>
  </div>
</div>
