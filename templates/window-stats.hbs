{{!-- Party Statistics Window Template --}}
<div class="stats-window foundry-style-window">
  <div class="stats-header-sticky">
    <div class="stats-header">
      <div class="stats-header-content">
        <div class="stats-header-icon"><i class="fas fa-chart-line"></i></div>
        <div class="stats-header-title">
          <div class="stats-header-maintitle">Party Statistics</div>
          <div class="stats-header-subtitle">Review recent combats and lifetime performance</div>
        </div>
        <div class="stats-header-controls">
          <div class="stats-toggle-container">
            <span class="stats-toggle-label">Combat History</span>
            <div class="stats-toggle">
              <input type="checkbox" id="toggleCombats" {{#if filters.showCombats}}checked{{/if}}>
              <label for="toggleCombats" class="stats-toggle-slider"></label>
            </div>
          </div>
          <div class="stats-toggle-container">
            <span class="stats-toggle-label">Lifetime Leaderboard</span>
            <div class="stats-toggle">
              <input type="checkbox" id="toggleLifetime" {{#if filters.showLifetime}}checked{{/if}}>
              <label for="toggleLifetime" class="stats-toggle-slider"></label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="stats-summary-row">
      <div class="stats-summary-item"><span class="label">Combats Tracked</span><span>{{summary.totalCombats}}</span></div>
      <div class="stats-summary-item"><span class="label">Average Hit Rate</span><span>{{summary.averageHitRate}}%</span></div>
      <div class="stats-summary-item"><span class="label">Top MVP</span><span>{{summary.topMvp}}</span></div>
      <div class="stats-summary-item"><span class="label">Best Score</span><span>{{summary.bestScore}}</span></div>
      <div class="stats-summary-item"><span class="label">Last Combat</span><span>{{summary.lastCombatDate}}</span></div>
    </div>
  </div>

  <div class="stats-body-scroll">
    <div class="stats-section {{#unless filters.showCombats}}hidden{{/unless}}" data-section="combat-history">
      <div class="stats-section-header">
        <i class="fas fa-crosshairs"></i> Recent Combat History
        <div class="stats-section-header-actions">
          {{#if combats.length}}
          <button type="button" class="stats-action-btn delete-history-btn" title="Delete all combat history"><i class="fas fa-trash"></i> Delete Stats</button>
          <span class="button-divider">|</span>
          <button type="button" class="stats-action-btn export-history"><i class="fas fa-file-download"></i> Export Stats</button>
          <span class="button-divider">|</span>
          {{/if}}
          <button type="button" class="stats-action-btn import-history"><i class="fas fa-file-upload"></i> Import Stats</button>
        </div>
      </div>
      <div class="stats-table-wrapper" data-table-type="combats">
        <div class="stats-table-header">
          <span class="stats-table-col-1 stats-table-col-header">Combat</span>
          <span class="stats-table-col-2 stats-table-col-header">Date</span>
          <span class="stats-table-col-3 stats-table-col-header">Rounds</span>
          <span class="stats-table-col-4 stats-table-col-header">Hit Rate</span>
          <span class="stats-table-col-5 stats-table-col-header">MVP</span>
          <span class="stats-table-col-6 stats-table-col-header">Duration</span>
        </div>
        <div class="stats-table-body">
          {{#if combats.length}}
            {{#each combats}}
              <div class="stats-table-row" data-row-type="combat" data-combat-id="{{combatId}}">
                <span class="stats-table-col-1">{{label}}</span>
                <span class="stats-table-col-2">{{dateFormatted}}</span>
                <span class="stats-table-col-3">{{rounds}}</span>
                <span class="stats-table-col-4">{{hitRate}}</span>
                <span class="stats-table-col-5">{{mvpName}} ({{mvpScore}})</span>
                <span class="stats-table-col-6">
                <span class="stats-table-duration">{{duration}}</span>
                <button type="button" class="delete-combat-btn" title="Delete this combat" data-combat-id="{{combatId}}">
                  <i class="fas fa-times"></i>
                </button>
                </span>
              </div>
            {{/each}}
          {{else}}
            <div class="stats-empty-state">No combat history recorded yet.</div>
          {{/if}}
        </div>
      </div>
      <div class="stats-section-footer">Showing {{#if combats.length}}{{combats.length}}{{else}}0{{/if}} combat sessions.</div>
    </div>

    <div class="stats-section {{#unless filters.showLifetime}}hidden{{/unless}}" data-section="lifetime-leaderboard">
      <div class="stats-section-header"><i class="fas fa-trophy"></i> Lifetime Player Leaderboard</div>
      <div class="stats-table-wrapper" data-table-type="leaderboard">
        <div class="stats-table-header">
          <span class="stats-table-col-1 stats-table-col-header">Rank</span>
          <span class="stats-table-col-2 stats-table-col-header">Player</span>
          <span class="stats-table-col-3 stats-table-col-header">Combats</span>
          <span class="stats-table-col-4 stats-table-col-header">Total MVP</span>
          <span class="stats-table-col-5 stats-table-col-header">Avg MVP</span>
          <span class="stats-table-col-6 stats-table-col-header">Best MVP</span>
          <span class="stats-table-col-7 stats-table-col-header">Crits</span>
          <span class="stats-table-col-8 stats-table-col-header">Fumbles</span>
          <span class="stats-table-col-9 stats-table-col-header">Biggest Hit</span>
        </div>
        <div class="stats-table-body">
          {{#if leaderboard.length}}
            {{#each leaderboard}}
              <div class="stats-table-row" data-row-type="leaderboard" data-actor-id="{{actorId}}">
                <span class="stats-table-col-1">{{rank}}</span>
                <span class="stats-table-col-2">
                  <img class="player-portrait" src="{{img}}" alt="{{name}}">
                  <span class="player-name">{{name}}</span>
                </span>
                <span class="stats-table-col-3">{{mvp.combats}}</span>
                <span class="stats-table-col-4">{{mvp.totalScore}}</span>
                <span class="stats-table-col-5">{{mvp.averageScore}}</span>
                <span class="stats-table-col-6">{{mvp.highScore}}</span>
                <span class="stats-table-col-7">{{crits}}</span>
                <span class="stats-table-col-8">{{fumbles}}</span>
                <span class="stats-table-col-9">{{biggestHit}}</span>
              </div>
            {{/each}}
          {{else}}
            <div class="stats-empty-state">No lifetime MVP data yet.</div>
          {{/if}}
        </div>
      </div>
      <div class="stats-section-footer">Rank is based on overall MVP score.</div>
    </div>

    <div class="stats-section" data-section="mvp-history">
      <div class="stats-section-header"><i class="fas fa-medal"></i> Party Highlights</div>
      <div class="stats-highlight-grid">
        {{#if highlights.length}}
          {{#each highlights}}
            <div class="stats-highlight-card">
              <div class="highlight-header">
                <img class="player-portrait" src="{{img}}" alt="{{player}}">
                <div class="highlight-title">
                  <div class="highlight-player">{{player}}</div>
                  <div class="highlight-score">Score: {{score}}</div>
                </div>
              </div>
              <div class="highlight-body">
                <div><span class="label">Combat:</span> {{combat}}</div>
                <div><span class="label">Damage:</span> {{damage}}</div>
                <div><span class="label">Healing:</span> {{healing}}</div>
                <div><span class="label">Notes:</span> {{notes}}</div>
              </div>
            </div>
          {{/each}}
        {{else}}
          <div class="stats-empty-state">Complete a combat to see MVP highlights.</div>
        {{/if}}
      </div>
      <div class="stats-section-footer">Showing {{#if highlights.length}}{{highlights.length}}{{else}}0{{/if}} MVP highlights.</div>
    </div>
  </div>

  <div class="stats-footer">
    <div class="stats-footer-actions">
      <button type="button" class="stats-btn close-stats"><i class="fas fa-times"></i> Close</button>
    </div>
  </div>
</div>
