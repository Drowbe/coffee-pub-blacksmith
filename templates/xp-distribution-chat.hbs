<span style="visibility: none">coffeepub-hide-header</span>
{{!-- XP Distribution Chat Message Template --}}
<div class="dnd5e chat-card cpb-xp-card">
    <header class="card-header flexrow">
        <h3 class="item-name"><i class="fas fa-star"></i> XP Distribution</h3>
    </header>
    <div class="card-content">
        <div class="cpb-xp-card-section-header"><i class="fas fa-list-ol"></i> XP Summary</div>
        <div class="xp-totals">
            <p><strong>Total Encounter XP:</strong> {{xpData.totalXp}}</p>
            <p><strong>Party Size:</strong> {{xpData.partySize}} (Ã—{{formatMultiplier xpData.partyMultiplier}} multiplier)</p>
            <p><strong>Adjusted Total XP:</strong> {{xpData.adjustedTotalXp}}</p>
            <p><strong>Base XP per Player:</strong> {{xpData.xpPerPlayer}}</p>
        </div>

        {{!-- Player Results --}}
        {{#if results.length}}
        <div class="cpb-xp-card-section-header"><i class="fas fa-users"></i> Experience Allocations</div>
        <div class="player-list">
            {{#each results}}
            <div class="player-item">
                <div class="cpb-xp-player-info">
                    <img class="player-portrait" src="{{img}}" alt="{{name}}" />
                    <div class="cpb-xp-player-details">
                        <span class="cpb-actor-name">{{name}}</span>
                        <span class="total-xp">NEW XP: {{totalXp}}</span>
                    </div>
                </div>
                <div class="cpb-xp-player-awards">
                    <span class="xp-gained">+{{xpGained}} XP</span>
                    {{#if leveledUp}}
                    <span class="level-up">LEVEL UP!</span>
                    {{/if}}
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}

        {{!-- Monster Breakdown --}}
        {{#if xpData.monsters.length}}
        <div class="cpb-xp-card-section-header"><i class="fas fa-dragon"></i> Monster Resolutions</div>
        <div class="monster-list">
            {{#each xpData.monsters}}
            <div class="cpb-xp-monster-item">
                <div class="cpb-xp-monster-info">
                    <span class="cpb-xp-resolution-icon">
                        {{#if (eq resolutionType "DEFEATED")}}<i class="fas fa-skull"></i>{{/if}}
                        {{#if (eq resolutionType "NEGOTIATED")}}<i class="fas fa-people-arrows"></i>{{/if}}
                        {{#if (eq resolutionType "ESCAPED")}}<i class="fas fa-running"></i>{{/if}}
                        {{#if (eq resolutionType "IGNORED")}}<i class="fas fa-person-walking-arrow-loop-left"></i>{{/if}}
                        {{#if (eq resolutionType "CAPTURED")}}<i class="fas fa-person-praying"></i>{{/if}}
                    </span>
                    <span class="cpb-xp-monster-name" title="{{name}}">{{name}}</span>
                </div>
                <span class="cpb-xp-monster-points">{{finalXp}} XP</span>
            </div>
            {{/each}}
        </div>
        {{/if}}

    </div>
</div> 