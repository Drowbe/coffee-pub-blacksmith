{{!-- XP Distribution Window Template --}}
<div class="xp-distribution foundry-style-window">
  <div class="xp-header">
    <i class="fas fa-star"></i>
    <span>XP Distribution</span>
  </div>
  <div class="xp-body">
    <div class="xp-summary-row">
      <div class="xp-summary-item"><span class="label">Total XP</span><span>{{xpData.totalXp}}</span></div>
      <div class="xp-summary-item"><span class="label">Party Size</span><span>{{xpData.partySize}}</span></div>
      <div class="xp-summary-item"><span class="label">Multiplier</span><span>{{xpData.partyMultiplier}}x</span></div>
      <div class="xp-summary-item"><span class="label">Adjusted</span><span>{{xpData.adjustedTotalXp}}</span></div>
      <div class="xp-summary-item highlight"><span class="label">Per Player</span><span>{{xpData.xpPerPlayer}}</span></div>
    </div>

    <div class="xp-section">
      <div class="xp-section-header"><i class="fas fa-dragon"></i> Monster Resolutions</div>
      <div class="xp-monster-list">
        {{#each xpData.monsters}}
        <div class="xp-monster-row">
          <span class="monster-name">{{name}}</span>
          <span class="monster-cr">CR {{cr}}</span>
          <select class="monster-resolution-select" name="monster-resolution-{{id}}" data-monster-id="{{id}}">
            {{#each ../resolutionTypes}}
            <option value="{{this}}" {{#if (eq ../resolutionType this)}}selected{{/if}}>{{prettifyResolution this}}</option>
            {{/each}}
          </select>
          <span class="monster-xp-calc">{{baseXp}} Ã—{{multiplier}} = <strong>{{finalXp}}</strong></span>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="xp-section">
      <div class="xp-section-header"><i class="fas fa-users"></i> Player Adjustments</div>
      <div class="xp-player-list">
        {{#each xpData.players}}
        <div class="xp-player-row">
          <span class="player-name">{{actor.name}}</span>
          <span class="player-base-xp">{{../xpData.xpPerPlayer}}</span>
          <span class="plus">+</span>
          <input type="number" class="player-adjustment" name="player-adjustment-{{actorId}}" value="0" min="-1000" max="10000" placeholder="0">
          <span class="equals">=</span>
          <span class="calculated-total">{{../xpData.xpPerPlayer}}</span>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="xp-section">
      <div class="xp-section-header"><i class="fas fa-info-circle"></i> Resolution Types</div>
      <div class="xp-legend-list">
        <div class="xp-legend-row"><i class="fas fa-sword"></i> <span class="legend-label">Defeated:</span> <span class="legend-desc">Full XP (combat victory)</span></div>
        <div class="xp-legend-row"><i class="fas fa-handshake"></i> <span class="legend-label">Negotiated:</span> <span class="legend-desc">Full XP (diplomatic success)</span></div>
        <div class="xp-legend-row"><i class="fas fa-running"></i> <span class="legend-label">Fled:</span> <span class="legend-desc">Half XP (monster retreated)</span></div>
        <div class="xp-legend-row"><i class="fas fa-eye-slash"></i> <span class="legend-label">Bypassed:</span> <span class="legend-desc">No XP (avoided entirely)</span></div>
        <div class="xp-legend-row"><i class="fas fa-cage"></i> <span class="legend-label">Captured:</span> <span class="legend-desc">Full XP (tactical success)</span></div>
      </div>
    </div>
  </div>
  <div class="xp-footer">
    <button type="button" class="xp-btn cancel-xp"><i class="fas fa-times"></i> Cancel</button>
    <button type="button" class="xp-btn apply-xp"><i class="fas fa-check"></i> Apply XP</button>
  </div>
</div> 