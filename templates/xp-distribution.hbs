{{!-- XP Distribution Window Template --}}
<div class="xp-distribution foundry-style-window">
  <div class="xp-header-sticky">
    <div class="xp-header">
      <i class="fas fa-swords"></i>
      <span>XP Overview</span>
    </div>
    <div class="xp-summary-row">
      <div class="xp-summary-item"><span class="label">Total XP</span><span>{{xpData.totalXp}}</span></div>
      <div class="xp-summary-item"><span class="label">Party Size</span><span>{{xpData.partySize}}</span></div>
      <div class="xp-summary-item"><span class="label">Multiplier</span><span>{{xpData.partyMultiplier}}x</span></div>
      <div class="xp-summary-item"><span class="label">Adjusted</span><span>{{xpData.adjustedTotalXp}}</span></div>
      <div class="xp-summary-item highlight"><span class="label">Per Player</span><span>{{xpData.xpPerPlayer}}</span></div>
    </div>
  </div>
  <div class="xp-body-scroll">
    <div class="xp-section">
      <div class="xp-section-header"><i class="fas fa-dragon"></i> Monster Resolutions</div>
      <div class="xp-monster-table">
        <div class="xp-monster-table-header">
          <span class="monster-col-name">Name</span>
          <span class="monster-col-cr">CR</span>
          <span class="monster-col-resolution">Resolution</span>
          <span class="monster-col-xp">XP</span>
        </div>
        <div class="xp-monster-list">
          {{#each xpData.monsters}}
          <div class="xp-monster-row">
            <span class="monster-col-name monster-name">{{name}}</span>
            <span class="monster-col-cr monster-cr">CR {{cr}}</span>
            <span class="monster-col-resolution">
              <select class="monster-resolution-select" name="monster-resolution-{{id}}" data-monster-id="{{id}}">
                {{#each ../resolutionTypes}}
                <option value="{{this}}" {{#if (eq ../resolutionType this)}}selected{{/if}}>{{prettifyResolution this}}</option>
                {{/each}}
              </select>
            </span>
            <span class="monster-col-xp monster-xp-calc">{{baseXp}} Ã—{{multiplier}} = <strong>{{finalXp}}</strong></span>
          </div>
          {{/each}}
        </div>
      </div>
    </div>

    <div class="xp-section">
      <div class="xp-section-header"><i class="fas fa-users"></i> Player Adjustments</div>
      <div class="xp-player-list">
        {{#each xpData.players}}
        <div class="xp-player-row">
          <span class="player-name">{{actor.name}}</span>
          <span class="player-base-xp">{{../xpData.xpPerPlayer}}</span>
          <span class="plus">+</span>
          <input type="number" class="player-adjustment" name="player-adjustment-{{actorId}}" value="0" min="-1000" max="10000" placeholder="0">
          <span class="equals">=</span>
          <span class="calculated-total">{{../xpData.xpPerPlayer}}</span>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="xp-section">
      <div class="xp-section-header"><i class="fas fa-info-circle"></i> Resolution Types</div>
      <div class="xp-legend-list">
        {{#each legendTypes}}
        <div class="xp-legend-row">
          {{#if (eq key "DEFEATED")}}<i class="fas fa-skull"></i>{{/if}}
          {{#if (eq key "NEGOTIATED")}}<i class="fas fa-people-arrows"></i>{{/if}}
          {{#if (eq key "ESCAPED")}}<i class="fas fa-running"></i>{{/if}}
          {{#if (eq key "IGNORED")}}<i class="fas fa-person-walking-arrow-loop-left"></i>{{/if}}
          {{#if (eq key "CAPTURED")}}<i class="fas fa-person-praying"></i>{{/if}}
          <span class="legend-label">{{label}}:</span>
          <span class="legend-desc">{{desc}} <span style="color:var(--color-accent,#ffd700);font-weight:700;">({{multiplier}}x)</span></span>
        </div>
        {{/each}}
      </div>
    </div>
  </div>
  <div class="xp-footer">
    <button type="button" class="xp-btn cancel-xp"><i class="fas fa-times"></i> Cancel</button>
    <button type="button" class="xp-btn apply-xp"><i class="fas fa-check"></i> Apply XP</button>
  </div>
</div>
