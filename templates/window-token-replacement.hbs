<div class="token-replacement-window">
    {{!-- Custom Header --}}
    <div class="tir-header">
        <div class="tir-header-content">
            <div class="tir-header-icon">
                <i class="fas fa-images"></i>
            </div>
            <div class="tir-header-title">
                <div class="tir-main-title">Token Image Replacement</div>
                <div class="tir-subtitle">Replace Token Images • Browse Matches • Manual Selection</div>
            </div>
        </div>
    </div>
    
    {{#if isScanning}}
    <div class="tir-scan-progress">
        <div class="tir-progress-header">
            <h3><i class="fas fa-sync-alt fa-spin"></i> Scanning Token Images...</h3>
        </div>
        <div class="tir-progress-bar">
            <div class="tir-progress-fill" style="width: {{#if scanTotal}}{{math scanProgress "*" 100 "/" scanTotal}}{{else}}0{{/if}}%"></div>
        </div>
        <div class="tir-progress-text">
            {{#if scanTotal}}
                {{scanProgress}} of {{scanTotal}} files scanned
            {{else}}
                Initializing scan...
            {{/if}}
        </div>
    </div>
    {{/if}}
    
    <div class="tir-content">
        {{#if selectedToken}}
            <!-- Token Info Header -->
            <div class="tir-token-info-header">
                <div class="tir-token-preview-small">
                    <img src="{{selectedToken.texture.src}}" alt="{{selectedToken.name}}" class="tir-token-image-small">
                </div>
                <div class="tir-token-details">
                    <div class="tir-token-name">{{selectedToken.name}}</div>
                    <div class="tir-token-type">{{selectedToken.actor.type}}</div>
                </div>
                <div class="tir-header-actions">
                    <button class="tir-button tir-button-secondary refresh-cache-btn" title="Refresh Image Cache">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Image Grid -->
            {{#if hasMatches}}
                <div class="tir-thumbnails-grid">
                    {{#each matches}}
                    <div class="tir-thumbnail-item {{#if isCurrent}}tir-current-image{{/if}}" data-image-path="{{fullPath}}" data-image-name="{{name}}">
                        <div class="tir-thumbnail-image">
                            <img src="{{fullPath}}" alt="{{name}}" loading="lazy">
                            {{#if isCurrent}}
                            <div class="tir-thumbnail-current-badge">
                                <i class="fas fa-check"></i>
                            </div>
                            {{else}}
                            <div class="tir-thumbnail-overlay">
                                <i class="fas fa-check"></i>
                            </div>
                            {{/if}}
                        </div>
                        <div class="tir-thumbnail-name">{{name}}</div>
                    </div>
                    {{/each}}
                </div>
            {{else}}
                <div class="tir-no-matches">
                    <div class="tir-no-matches-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="tir-no-matches-text">
                        <p>No matches found for this token</p>
                        <p>Try refreshing the cache or selecting a different token</p>
                    </div>
                </div>
            {{/if}}
        {{else}}
            <div class="tir-no-token">
                <div class="tir-no-token-icon">
                    <i class="fas fa-user-slash"></i>
                </div>
                <div class="tir-no-token-text">
                    <p>No token selected</p>
                    <p>Select a token on the canvas to view replacement options</p>
                    <button class="tir-button tir-button-primary refresh-detection-btn" style="margin-top: 15px;">
                        <i class="fas fa-sync-alt"></i> Refresh Detection
                    </button>
                </div>
            </div>
        {{/if}}
    </div>
    
    <!-- Footer -->
    <div class="tir-footer">
        <button class="tir-button tir-button-secondary close-btn">
            <i class="fas fa-times"></i> Close
        </button>
    </div>
</div>
