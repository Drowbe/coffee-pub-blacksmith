<span style="visibility: hidden">coffeepub-hide-header</span>

<div class="blacksmith-card theme-default">
    <div class="card-header">
        <i class="fa-solid fa-flag-checkered"></i>
        Combat Summary: {{sceneName}}
    </div>
    <div class="section-content">
        <div class="party-stats-grid">
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-clock"></i> Duration</h4>
                <div class="round-stat-value">{{formatTime duration}}</div>
                <div class="round-stat-detail">{{durationSeconds}} seconds</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-arrows-rotate"></i> Rounds</h4>
                <div class="round-stat-value">{{totalRounds}}</div>
                <div class="round-stat-detail">Total rounds fought</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-bullseye"></i> Hit Rate</h4>
                <div class="round-stat-value">{{totals.hitRate}}%</div>
                <div class="round-stat-detail">Hits {{totals.hits}} / Misses {{totals.misses}}</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-swords"></i> Damage Dealt</h4>
                <div class="round-stat-value">{{formatDamage totals.damageDealt}} hp</div>
                <div class="round-stat-detail">Party total</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-shield-halved"></i> Damage Taken</h4>
                <div class="round-stat-value">{{formatDamage totals.damageTaken}} hp</div>
                <div class="round-stat-detail">Enemies inflicted</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-heart"></i> Healing Given</h4>
                <div class="round-stat-value">{{formatDamage totals.healingGiven true}} hp</div>
                <div class="round-stat-detail">Total restored</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-burst"></i> Crits</h4>
                <div class="round-stat-value">{{totals.criticals}}</div>
                <div class="round-stat-detail">Across the party</div>
            </div>
            <div class="round-stat-card">
                <h4><i class="fa-solid fa-skull-crossbones"></i> Fumbles</h4>
                <div class="round-stat-value">{{totals.fumbles}}</div>
                <div class="round-stat-detail">Oops moments</div>
            </div>
        </div>
    </div>
</div>

{{#if notableMoments.mvp}}
<div class="blacksmith-card-spacer"></div>
<div class="blacksmith-card theme-default">
    <div class="card-header">
        <i class="fa-solid fa-trophy"></i>
        Combat MVP: {{notableMoments.mvp.name}}
    </div>
    <div class="section-content">
        <div class="mvp-details">
            <div class="mvp-info">
                <div class="player-name">{{notableMoments.mvp.name}}</div>
                <p class="mvp-description">Score {{notableMoments.mvp.score}}</p>
            </div>
        </div>
        <div class="mvp-stats">
            <div class="mvp-stat-card">
                <h4><i class="fas fa-swords"></i> Combat</h4>
                <div class="moment-content">
                    <span class="detail">Hits:</span>
                    <span class="amount">{{notableMoments.mvp.hits}} / {{notableMoments.mvp.totalAttacks}}</span>
                    <span class="detail">Crits:</span>
                    <span class="amount">{{notableMoments.mvp.crits}}</span>
                    <span class="detail">Fumbles:</span>
                    <span class="amount">{{notableMoments.mvp.fumbles}}</span>
                </div>
            </div>
            <div class="mvp-stat-card">
                <h4><i class="fas fa-droplet"></i> Damage</h4>
                <div class="moment-content">
                    <span class="detail">Dealt:</span>
                    <span class="amount">{{notableMoments.mvp.damageDealt}}</span>
                    <span class="detail">Taken:</span>
                    <span class="amount">{{notableMoments.mvp.damageTaken}}</span>
                </div>
            </div>
            <div class="mvp-stat-card">
                <h4><i class="fas fa-heart"></i> Healing</h4>
                <div class="moment-content">
                    <span class="detail">Given:</span>
                    <span class="amount">{{notableMoments.mvp.healingGiven}}</span>
                    <span class="detail">Received:</span>
                    <span class="amount">{{notableMoments.mvp.healingReceived}}</span>
                </div>
            </div>
        </div>
        {{#if mvpRankings}}
        <div class="mvp-ranking-table">
            {{#each mvpRankings}}
            <div class="turn-row">
                <div class="turn-info">
                    <div class="turn-name">
                        <span class="status-tag rank">{{add @index 1}}</span>
                        <strong>{{name}}</strong>
                        <span class="turn-time">Score {{score}}</span>
                    </div>
                    <div class="turn-stats">DMG {{damageDealt}} • Hits {{hits}}/{{totalAttacks}} • Crits {{crits}} • Heals {{healingGiven}}</div>
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}
    </div>
</div>
{{/if}}

{{#if (or notableMoments.topHits.length notableMoments.topHeals.length)}}
<div class="blacksmith-card-spacer"></div>
<div class="blacksmith-card theme-default">
    <div class="card-header">
        <i class="fa-solid fa-medal"></i>
        Notable Moments
    </div>
    <div class="section-content">
        <div class="notable-moments-grid">
            {{#each notableMoments.topHits}}
            <div class="moment-card">
                <h4><i class="fas fa-burst"></i> Top Hit #{{add @index 1}}</h4>
                <div class="moment-info">
                    <div>
                        <span class="actor">{{attacker}}</span>
                        <span class="detail">hit</span>
                        <span class="target">{{target}}</span>
                    </div>
                    <div>
                        <span class="amount">{{formatDamage amount}} hp</span>
                        {{#if isCritical}}<span class="detail">• Critical!</span>{{/if}}
                    </div>
                </div>
            </div>
            {{/each}}

            {{#each notableMoments.topHeals}}
            <div class="moment-card">
                <h4><i class="fas fa-heart"></i> Top Heal #{{add @index 1}}</h4>
                <div class="moment-info">
                    <div>
                        <span class="actor">{{healer}}</span>
                        <span class="detail">healed</span>
                        <span class="target">{{target}}</span>
                    </div>
                    <div>
                        <span class="amount">{{formatDamage amount true}} hp</span>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
    </div>
</div>
{{/if}}

{{#if participants}}
<div class="blacksmith-card-spacer"></div>
<div class="blacksmith-card theme-default">
    <div class="card-header">
        <i class="fa-solid fa-users"></i>
        Party Breakdown
    </div>
    <div class="section-content">
        {{#each participants}}
        <div class="turn-row">
            <div class="turn-info">
                <div class="turn-name">
                    <span class="status-tag rank">{{add @index 1}}</span>
                    <strong>{{name}}</strong>
                    <span class="turn-time">{{hits}} hits / {{totalAttacks}} attempts</span>
                </div>
                <div class="turn-stats">
                    DMG {{damageDealt}} • Taken {{damageTaken}} • Heals {{healingGiven}} • Crits {{criticals}} • Fumbles {{fumbles}}
                </div>
            </div>
        </div>
        {{/each}}
    </div>
</div>
{{/if}}

{{#if rounds}}
<div class="blacksmith-card-spacer"></div>
<div class="blacksmith-card theme-default">
    <div class="card-header">
        <i class="fa-solid fa-list-ol"></i>
        Round Recap
    </div>
    <div class="section-content">
        {{#each rounds}}
        <div class="turn-row">
            <div class="turn-info">
                <div class="turn-name">
                    <span class="status-tag rank">R{{this.round}}</span>
                    <strong>Round {{this.round}}</strong>
                </div>
                <div class="turn-stats">
                    Duration {{formatTime summary.duration}} • Hits {{summary.hits}} • Misses {{summary.misses}} • Damage {{summary.damage}} • Healing {{summary.healing}}
                </div>
            </div>
        </div>
        {{/each}}
    </div>
</div>
{{/if}}