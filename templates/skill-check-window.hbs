<div class="skill-check-dialog">
    <div class="cpb-dialog-content">
        <!-- Left Column -->
        <div class="cpb-dialog-column">
            <h2>CHOOSE CONTESTANTS</h2>
            <div class="cpb-form-group">
                <div class="cpb-form-fields cpb-search-container">
                    <input type="text" name="search" placeholder="Search actors, monsters, and npcs...">
                    <button type="button" class="cpb-clear-search-button" title="Clear search">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="cpb-filter-buttons">
                <button type="button" class="cpb-filter-btn {{#if (eq initialFilter 'party')}}active{{/if}}" data-filter="party">
                    <i class="fas fa-helmet-battle"></i> Party
                </button>
                <button type="button" class="cpb-filter-btn {{#if (eq initialFilter 'monster')}}active{{/if}}" data-filter="monster">
                    <i class="fas fa-dragon"></i> NPCs
                </button>
                <button type="button" class="cpb-filter-btn {{#if (eq initialFilter 'canvas')}}active{{/if}}" data-filter="canvas">
                    <i class="fas fa-user-group-crown"></i> Canvas
                </button>
                <button type="button" class="cpb-filter-btn {{#if (eq initialFilter 'selected')}}active{{/if}}" data-filter="selected">
                    <i class="fas fa-square-dashed"></i> Selected
                </button>
            </div>
            <div class="cpb-actor-list">
                {{#each actors}}
                    <div class="cpb-actor-item" data-token-id="{{this.id}}">
                        <img src="{{this.actor.img}}" alt="{{this.name}}">
                        <div class="cpb-actor-details">
                            <div class="cpb-actor-name">{{this.name}}</div>
                            {{#if (eq this.type "character")}}
                                <div class="cpb-actor-info">Level {{this.level}} {{this.class}}</div>
                            {{else}}
                                <div class="cpb-actor-info">{{this.type}}</div>
                            {{/if}}
                            <div class="cpb-actor-info">HP: {{this.hp.value}}/{{this.hp.max}}</div>
                        </div>
                        <div class="cpb-group-indicator"></div>
                    </div>
                {{/each}}
            </div>
            <h3>Left-click to select. Right-click if a Defender.</h3>
        </div>

        <!-- Middle Column -->
        <div class="cpb-dialog-column">
            <h2>SET ROLL TYPE</h2>
            
            <div class="cpb-form-group">
                <div class="cpb-form-fields cpb-search-container">
                    <input type="text" name="search" placeholder="Search roll types...">
                    <button type="button" class="cpb-clear-search-button" title="Clear search">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="cpb-checks-list">
                <!-- Quick Roll Section -->
                <div class="cpb-check-section">
                    <div class="cpb-section-header" style="margin-bottom: 8px;">quick ROLLS</div>
                    <div class="cpb-section-subheader" style="margin-bottom: 8px;">Party Rolls (Auto-selects Party)</div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="party" data-value="perception" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="Party Perception"></i> Party Perception
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="party" data-value="insight" data-group="true">
                        <i class="fas fa-brain" title="Party Insight"></i> Party Insight
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="party" data-value="investigation" data-group="true">
                        <i class="fas fa-magnifying-glass" title="Party Investigation"></i> Party Investigation
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="party" data-value="nature" data-group="true">
                        <i class="fas fa-sheep" title="Party Nature"></i> Party Nature
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="party" data-value="stealth" data-group="true">
                        <i class="fas fa-burst" title="Party Stealth"></i> Party Stealth
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div> 
                    </div>
                    <div class="cpb-section-subheader" style="margin-bottom: 8px;">COMMON ROLLS</div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="perception" data-dc="10" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 15 Group Perception"></i> DC 10 Perception
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="perception" data-dc="15" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 15 Group Perception"></i> DC 15 Perception
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>

                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="insight" data-dc="10" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 10 Group Insight"></i> DC 10 Insight
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>

                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="insight" data-dc="15" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 15 Group Insight"></i> DC 15 Insight
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>

                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="insight" data-dc="10" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 10 Group Insight"></i> DC 10 Insight
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>

                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="insight" data-dc="15" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 15 Group Insight"></i> DC 15 Insight
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>

                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="investigation" data-dc="10" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 10 Group Investigation"></i> DC 10 Investigation
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>

                    <div class="cpb-check-item" data-type="quick" data-roll-type="individual" data-value="investigation" data-dc="15" data-group="true">
                        <i class="fas fa-magnifying-glass-waveform" title="DC 15 Group Investigation"></i> DC 15 Investigation
                        <div class="cpb-roll-type-auto"><i class="fas fa-play"></i></div>
                    </div>
                </div>

                <!-- Skill Check Section -->
                <div class="cpb-check-section">
                    <div class="cpb-section-header">Skill Check</div>
                    {{#each skills}}
                    <div class="cpb-check-item" data-type="skill" data-value="{{this.id}}">
                        <i class="{{this.icon}}"></i>
                        <span>{{this.name}}</span>
                        <div class="cpb-roll-type-indicator"></div>
                    </div>
                    {{/each}}
                </div>

                <!-- Ability Check Section -->
                <div class="cpb-check-section">
                    <div class="cpb-section-header">Ability Check</div>
                    {{#each abilities}}
                    <div class="cpb-check-item" data-type="ability" data-value="{{this.id}}">
                        <i class="fas fa-user-circle"></i>
                        <span>{{this.name}}</span>
                        <div class="cpb-roll-type-indicator"></div>
                    </div>
                    {{/each}}
                </div>

                <!-- Saving Throw Section -->
                <div class="cpb-check-section">
                    <div class="cpb-section-header">Saving Throw</div>
                    {{#each saves}}
                    <div class="cpb-check-item" data-type="save" data-value="{{this.id}}">
                        <i class="fas fa-shield-heart"></i>
                        <span>{{this.name}}</span>
                        <div class="cpb-roll-type-indicator"></div>
                    </div>
                    {{/each}}
                </div>

                <!-- Dice Roll Section -->
                <div class="cpb-check-section">
                    <div class="cpb-section-header" style="margin-bottom: 8px;">Dice Roll</div>
                    <div class="cpb-dice-grid">
                        <div class="cpb-check-item" data-type="dice" data-value="d2">
                            <i class="fas fa-coin" title="d2"></i> 1d2
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                        <div class="cpb-check-item" data-type="dice" data-value="d4">
                            <i class="fas fa-dice-d4" title="d4"></i> 1d4
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                    </div>
                    <div class="cpb-dice-grid">
                        <div class="cpb-check-item" data-type="dice" data-value="d6">
                            <i class="fas fa-dice-d6" title="d6"></i> 1d6
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                        <div class="cpb-check-item" data-type="dice" data-value="d8">
                            <i class="fas fa-dice-d8" title="d8"></i> 1d8
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                    </div>
                    <div class="cpb-dice-grid">
                        <div class="cpb-check-item" data-type="dice" data-value="d10">
                            <i class="fas fa-dice-d10" title="d10"></i> 1d10
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                        <div class="cpb-check-item" data-type="dice" data-value="d12">
                            <i class="fas fa-dice-d12" title="d12"></i> 1d12
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                    </div>
                    <div class="cpb-dice-grid">
                        <div class="cpb-check-item" data-type="dice" data-value="d20">
                            <i class="fas fa-dice-d20" title="d20"></i> 1d20
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                        <div class="cpb-check-item" data-type="dice" data-value="d100">
                            <i class="fas fa-hundred-points" title="d100"></i> 1d100
                            <div class="cpb-roll-type-indicator"></div>
                        </div>
                    </div>
                </div>

                <!-- Tool Check Section -->
                <div class="cpb-check-section">
                    <div class="cpb-section-header">Tool Check</div>
                    {{#each tools}}
                    <div class="cpb-check-item{{#unless isCommon}} cpb-tool-unavailable{{/unless}}" data-type="tool" data-value="{{id}}" data-common="{{isCommon}}">
                        <i class="fas fa-tools"></i>
                        <span>{{name}}</span>
                        <div class="cpb-roll-type-indicator"></div>
                    </div>
                    {{/each}}
                </div>
            </div>
            <h3>Right-click to set a different defender type.</h3>
        </div>

        <!-- Right Column -->
        <div class="cpb-dialog-column">
            <h2>CONFIGURE ROLL</h2>
            <div class="cpb-form-group">
                <div class="cpb-form-fields">
                    <select name="rollMode">
                        <option value="roll">Public Roll</option>
                        <option value="gmroll">Private Roll</option>
                        <option value="blindroll">GM Only</option>
                    </select>
                </div>
            </div>
            
            <div class="cpb-roll-options-column">

                <div class="cpb-section-header">Difficulty Class</div>

                <div class="cpb-form-group">
                    <div class="cpb-form-fields">
                        <input type="number" name="dc" placeholder="Optional DC... e.g. 13 or 15">
                    </div>
                    <div class="cpb-form-fields">
                        <label class="cpb-checkbox">
                            <input type="checkbox" name="showDC" {{#if userPreferences.showDC}}checked{{/if}}> Show the DC to the players
                        </label>
                    </div>
                    <div class="cpb-form-fields">
                        <label class="cpb-checkbox">
                            <input type="checkbox" name="groupRoll" {{#if userPreferences.groupRoll}}checked{{/if}}> Evaluate Group DC
                        </label>
                    </div>
                </div>

                <div class="cpb-section-header">Additional Context</div>

                <div class="cpb-form-group">
                    <div class="cpb-form-fields">
                        <label class="cpb-checkbox">
                            <input type="checkbox" name="showRollExplanation" {{#if userPreferences.showRollExplanation}}checked{{/if}}> Show Roll Type Details
                        </label>
                    </div>
                    <div class="cpb-form-fields">
                        <label class="cpb-checkbox">
                            <input type="checkbox" name="showRollExplanationLink" {{#if userPreferences.showRollExplanationLink}}checked{{/if}}> Show Link to SRD
                        </label>
                    </div>
                    <div class="cpb-form-fields">
                        <label class="cpb-checkbox">
                            <input type="checkbox" name="isCinematic" {{#if userPreferences.isCinematic}}checked{{/if}}> Cinematic Mode
                        </label>
                    </div>
                </div>
                <div class="cpb-section-header">Custom Narrative</div>
                <div class="cpb-form-group">
                    <div class="cpb-form-fields">
                        <input type="text" name="label" placeholder="Optional title...">
                    </div>
                </div>
                <div class="cpb-form-group">
                    <div class="cpb-form-fields">
                        <textarea name="description" rows="4" placeholder="Optional narrative..."></textarea>
                    </div>
                </div>
            </div>
            <h3>Contested roll overrides group settings.</h3>
        </div>
    </div>
    <!-- BUTTONS -->
    <div class="cpb-dialog-buttons">
        <button class="cpb-dialog-button" data-button="cancel">
            <i class="fas fa-times"></i>
            Cancel
        </button>
        <button class="cpb-dialog-button" data-button="roll">
            <i class="fas fa-dice-d20"></i>
            Request Roll
        </button>
    </div>
</div>

